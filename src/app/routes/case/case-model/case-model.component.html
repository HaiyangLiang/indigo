<div>
  <div class="content__title">
    <h1 style="padding-left: 10px;">{{'content-title-case'|translate}}</h1>
    <span>
      <span [style.color]="isSaved?'black':'lightseagreen'">{{case.summary}}</span>
      <span *ngIf="case._id">
        <a style="color:lightgray;padding-left:5px;font-size:smaller;" [routerLink]="['/case', case.group, case.project, case._id]">({{case._id}})</a>
      </span>
    </span>
  </div>
  <nz-card [nzBordered]="true">
    <nz-row style="margin-bottom:4px;">
      <nz-input-group [nzSize]="'small'" [nzAddOnBefore]="'field-summary'|translate">
        <input type="text" nz-input [(ngModel)]="case.summary" (ngModelChange)="modelChange()">
      </nz-input-group>
    </nz-row>
    <!-- url row start -->
    <nz-affix [nzOffsetTop]="54" (nzChange)="onAffixChange($event)">
      <div [class]="isAffixed?'affixed':''" style="height:32px;line-height:32px;display:flex;">
        <div style="width:100%;">
          <nz-input-group [nzSize]="'default'" [nzAddOnBefore]="addOnBeforeTemplate">
            <input nz-input style="width:100%;" [placeholder]="'tips-enter-url'|translate" [(ngModel)]="case.request.rawUrl"
              (ngModelChange)="urlChange()">
          </nz-input-group>
          <ng-template #addOnBeforeTemplate>
            <nz-select style="width:100px;" [(ngModel)]="case.request.method" (ngModelChange)="modelChange()">
              <nz-option *ngFor="let m of methods" [nzLabel]="m" [nzValue]="m"></nz-option>
            </nz-select>
          </ng-template>
        </div>
        <div style="display:flex;padding-left:20px;">
          <button nz-button [nzType]="'primary'" [nzSize]="'default'" [nzLoading]="isSending" (click)="send()">
            <span>
              <i class="anticon anticon-scan"></i>
              <span>{{'btn-send'|translate}}</span>
            </span>
          </button>
          <nz-dropdown-button (nzClick)="save()" style="padding-left:5px;" [nzTrigger]="'hover'" [nzPlacement]="'bottomRight'">
            <span [style.color]="isSaved?'lightgray':'orangered'">
              <i class="anticon anticon-save"></i>
              <span>{{'btn-save'|translate}}</span>
            </span>
            <ul nz-menu>
              <li nz-menu-item (click)="saveAs()">
                <a>{{'btn-save-as'|translate}}</a>
              </li>
              <li nz-menu-item (click)="reset()">
                <a>{{'btn-reset'|translate}}</a>
              </li>
            </ul>
          </nz-dropdown-button>
          <button nz-button [nzType]="'default'" [nzSize]="'default'" style="margin-left:5px;padding:0px 10px;" (click)="history()">
            <span>
              <i class="anticon anticon-cloud-o"></i>
              <span>{{'btn-history'|translate}}</span>
            </span>
          </button>
        </div>
      </div>
    </nz-affix>
    <!-- url row end -->
    <div style="height:7px;"></div>
    <nz-tabset [nzSize]="'default'" [nzType]="'line'" [(nzSelectedIndex)]="tabIndex" [nzAnimated]="false">
      <nz-tab [nzTitle]="'item-path-variable'|translate">
        <app-key-value [(data)]="case.request.path" (dataChange)="modelChange()"></app-key-value>
      </nz-tab>
      <nz-tab [nzTitle]="'item-params'|translate">
        <app-key-value [(data)]="case.request.query" (dataChange)="paramsChange()"></app-key-value>
      </nz-tab>
      <nz-tab [nzTitle]="'item-headers'|translate">
        <app-key-value [(data)]="case.request.header" (dataChange)="modelChange()"></app-key-value>
      </nz-tab>
      <nz-tab [nzTitle]="'item-cookies'|translate">
        <app-key-value [(data)]="case.request.cookie" (dataChange)="modelChange()"></app-key-value>
      </nz-tab>
      <nz-tab [nzTitle]="'item-body'|translate" [nzDisabled]="'GET'===case.request.method">
        <app-media-object [(type)]="case.request.contentType" [(data)]="case.request.body" (typeChange)="modelChange()"
          (dataChange)="modelChange()">
        </app-media-object>
      </nz-tab>
      <nz-tab [nzTitle]="'item-result-assert'|translate">
        <app-result-assert [(index)]="assertResultTabIndex" [result]="testResult" [(assert)]="case.assert" [lastResult]="lastResult"
          (assertChange)="modelChange()">
        </app-result-assert>
      </nz-tab>
    </nz-tabset>
  </nz-card>
  <!-- drawer -->
  <nz-drawer [nzClosable]="true" [nzVisible]="historyVisible" nzPlacement="right" [nzTitle]="'title-case-history'|translate"
    (nzOnClose)="historyVisible=false">
    <app-case-history [group]="group" [project]="project" (onclick)="editCase($event)"></app-case-history>
  </nz-drawer>
</div>
